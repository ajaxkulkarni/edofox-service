<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.rns.web.edo.service.dao.EdoTestsDao">
	<!-- result maps -->
	<resultMap type="com.rns.web.edo.service.domain.EdoSubject" id="chapters">
		<id property="id" column="subject_id" />
		<result property= "subjectName" column="subject" />
		
		<collection property="chapters" javaType="List" ofType="com.rns.web.edo.service.domain.EdoChapter">
			<id property="chapterId" column="id" />
			<result property="chapterName" column="chapter_name" />
			<result property= "std" column="class" />
		</collection>

	</resultMap>


	<select id="getAllSubjects" resultMap="chapters" >
		SELECT * FROM test_subjects left join chapters on test_subjects.subject_id = chapters.subject;
	</select>
	
	<insert id="addQuestion" parameterType="com.rns.web.edo.service.domain.EdoQuestion">
		<!-- <foreach collection="test.test" item="question" index="index">
		insert into test_result (test_id,student_id,question_id,option_selected,flagged) values(${test.id}, ${student.id},${question.qn_id}, '${question.answer}',0);
		</foreach> -->
		insert into test_questions (subject_id,question,option1,option2,option3,option4,correct_answer,question_img_url,
							solution,weightage,negative_marks,created_date,question_type,exam_type,chapter) 
                            values (${subjectId},'${question}','${option1}','${option2}','${option3}','${option4}','${correctAnswer}','${questionImageUrl}',
                            '${solution}',${weightage},${negativeMarks},CURRENT_TIMESTAMP,'${type}','${examType}',${chapter.chapterId})
	</insert>

	<select id="getNoOfQuestionsByChapter" resultType="Integer" parameterType="Integer" >
		select count(*) from test_questions where chapter = ${value};
	</select>
	
	<select id="getNoOfQuestionsByDate" resultType="Integer" parameterType="String" >
		select count(*) from test_questions where created_date >= '${value}';
	</select>

</mapper>